# mysql 엔진 아키텍처
- mysql 서버는 다른 DBMS에 비해 구조가 독특하다.
- 다른 DBMS에 비해 장단점이 존재한다.

<br>

## mysql 전체 구조
- mysql 서버
  - mysql 엔진
    - 클라이언트로부터 접속 및 쿼리요청을 처리하는커넥션 핸들러
    - SQL 파서 및 전처리기
    - 쿼리의 최적화된 실행을 위한 SQL 옵티마이저
  - 스토리지 엔진
    - InnoDB, MyISAM, Memory
    - 실제 데이터를 디스크 스토리지에 저장하거나 읽어오는 역할을 담당.
    - mysql 엔진은 하나지만 스토리지 엔진은 여러개를 동시에 사용할 수 있다.
    - 처음 스토리지 엔진을 지정하면 이후 테이블의 모든 작업은 정의된 엔진이 처리한다.
  - 운영체제 하드웨어
    - 디스크: 데이터 파일, 로그 파일

<br>

### 핸들러 API
- mysql 엔진의 쿼리 실행기에서 데이터를 읽기/쓰기 할때 스토리지 엔진에 읽기/쓰기 요청을 한다.
- 이걸 핸들러 요청이라 부르고 여기에 사용되는 API를 핸들러 API라고 함.

<br>

## mysql 스레딩 구조
프로세스 기반이 아닌 스레드 기반으로 동작

### 포그라운드 스레드 (클라이언트 스레드)
- 최소한 mysql서버에 접속한 클라이언트 수 만큼 존재
- 주로 클라이언트 사용자가 요청하는 쿼리문장을 처리한다.
- innodb는 데이터 버퍼&캐시 까지만 처리하고 버퍼에서 디스크로 기록하는 작업은 백그라운드 스레드가 담당.

### 백그라운드 스레드
- innodb에서의 역할
  - 인서트 버퍼를 병합하는 스레드
  - 로그를 디스크로 기록하는 스레드
  - 버퍼풀의 데이터를 디스크에 기록하는 스레드
  - 데이터를 버퍼로 읽어오는 스레드
  - 잠금이나 데드락을 모니터링하는 스레드
- 읽기 스레드는 주로 클라이언트 스레드가 담당하지만 쓰기 스레드는 아주 많은 작업을 백그라운드로 처리한다.
- myisam은 사용자스레드가 쓰기작업까지 담당하지만 innodb는 쓰기작업을 버퍼링해 일괄처리 한다.
  - myisam: 일반적인 쿼리는 쓰기 버퍼링 기능 사용 불가.
  - innodb는 insert, update, delete쿼리로 데이터가 변경될때 완전히 저장될때까지 기다리지 않아도 된다.
  - 즉, innodb는 읽기작업을 절대 지연하지 않으려고 노력한다.

### 개략적 설계안
#### 위치서비스
- 사용자의 위치를 기록하는 역할을 담당
- 클라이언트가 t초마다 자기 위치를 전송
- 높은 쓰기 부하에 적절하고 규모확장에 용이한 카산드라 같은 데이터베이스 필요
- 카프카 같은 스트림 처리 엔진을 활용해 위치데이터 로깅
- 프로토콜은 http, keep-alive 옵션 사용

#### 경로안내 서비스
- A-B 의 합리적으로 빠른 경로를 찾아주는 역할 담당
- 정확도가 보장되어야 한다.

#### 지도 표시
- 클라이언트의 위치, 보는 지도의 확대수준에 근거하여 필요한 지도타일을 즉석에서 만드는 방법
  - 모든 지도타일을 동적으로 만드는 심각한 부하 발생
  - 캐시를 활용하기 힘듬
- 미리 만들어준 지도 타일을 클라이언트에게 전달하는 방법
  - 현재 확대수준에 근거해 필요한 지도 타일 집합 결정
  - CDN을 통한 서비스
  - 규모확장, 성능 유리
 
### 상세 설계
#### 데이터 모델
- 경로안내타일
  - 별도의 서비스를 통해 가공 파이프라인을 주기적으로 실행해 경로안내타일로 변환
  - S3같은 객체저장소에 파일을 보관하고 서비스에서 적극적으로 캐싱해 활용
- 사용자 위치 데이터
  - 쓰기 연산과 수평적 규모확장이 용이한 데이터베이스 필요
- 지오코딩 데이터베이스
  - 주소를 위도/경도 쌍으로 변환하는 정보를 보관
  - 레디스같은 키-값 저장소 필요
- 미리 만들어둔 지도 이미지
  - 중복요청이 많으므로 계산된 이미지를 캐시해두는 전략 필요
  - CDN을 통한 전송

#### 서비스
- 위치서비스
  - 사용자 위치 데이터 저장은 쓰기연산 지원에 탁월한 키-값 저장소 사용
  - CAP 이론 중 가용성, 분할 내성을 만족시키는데 집중
  - 사용자 위치 데이터는 중요한 데이터이므로 메시지 큐를 활용해 다양한 서비스로 전달

#### 경로 안내 서비스
- 지오코딩 서비스
  - 주소를 위도/경도로 바꿔주는 서비스
  - 위도/경도로 변환한 후 다른 서비스 호출에 이용
- 경로 계획 서비스
  - 현재 교통,도로 상황을 토대로 이동시간측면에서 최적화도니 경로 제안
  - 다른 서비스들과 통신하여 결과를 만들어 낸다.
- 최단 경로 서비스
  - 출발지/목적지를 입력받아 k개의 최단경로를 반환하는 서비스
  - 교통상황과는 별개로 도로 구조에만 의존하여 계산을 수행한다.
  - 도로망 그래프는 거의 정적이므로 적극적으로 캐싱 활용
- 예상 도착 시간 서비스
  - 최단경로 목록을 수신하여 각각의 소요시간 추정치를 구한다.
  - 기계 학습을 활용해 현재교통상황 및 과거이력에 근거
  - 까다로운 미래 교통상황까지 예측해야 한다.
    - 알고리즘 차원에서 문제를 풀어야 한다.
- 순위 결정 서비스
  - 유료도로 제외, 고속도로 제외등의 필터링 조건을 수행하는 서비스
- 중요 정보 갱신 서비스들
  - 카프카 위치 데이터 스트림을 구독하고 비동기적으로 업데이트 한다.
  - 상태를 항상 최신으로 유지하는 역할 담당



















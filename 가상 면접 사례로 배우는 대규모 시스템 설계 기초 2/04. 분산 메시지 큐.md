### 분산 메시지 큐의 장점
- 결합도 완화
- 규모 확장성 개선
- 가용성 개선
- 성능 개선

### 상세 설계
#### 데이터 저장소
- 데이터 베이스
  - 관계형: 토픽별로 테이블 생성, 메시지는 레코드로 추가
  - NoSQL: 토픽별로 컬렉션 생성, 메시지는 하나의 문서
  - 대규모 읽기/쓰기 연산의 요구사항을 충족하기 어려움
  - 데이터 사용패턴을 지원하기 어려움
- WAL (쓰기 우선 로그)
  - 새로운 항목이 추가되기만 하는 일반 파일
  - WAL에 대한 접근패턴은 읽기/쓰기 모두 순차적: 디스크에 아주 좋은 성능을 보임
    - 회전식 디스크가 느린것은 데이터 접근패턴이 무작위 일때

#### 메시지 자료구조
- 메시지 키: 파티션을 정할 때 사용, 없을 시 무작위 결정
- 메시지 값: 메시지의 내용

#### 일괄처리
- 생산자, 소비자, 메시지 큐는 메시지를 가급적 일괄처리 한다.
  - 네트워크 비용, 디스크 캐시에 유리

#### 푸시 vs 풀
- 푸시모델
  - 장점
    - 낮은지연
  - 단점
    - 소비자의 처리속도가 느리면 소비자에 큰 부하 발생
- 풀 모델
  - 장점
    - 메시지 소비 속도를 소비자가 결정
    - 소비속도가 느릴경우 대처 가능
    - 일괄처리에 적합
  - 단점
    - 메시지가 없을 경우 소비자측 컴퓨팅 자원 낭비

#### 소비자 재조정
- 어떤 소비자가 어떤 파티션을 책임지는지 박동신호를 기준으로 다시 정하는 프로세스
  - 새로운 소비자 합류, 기존 소비자 떠남, 소비자 장애, 파티션 조정 등

#### 상태 저장소
- 소비자에 대한 파티션 배치관계
- 각 소비자 그룹이 가져간 마지막 오프셋

#### 메타데이터 저장소
- 파티션 수, 메시지 보관 기간, 사본 배치등의 정보 보관

#### 주키퍼
- 계층적 키-값 저장소 기능 제공
























## 단일 서버
![스크린샷 2024-07-05 오후 8 25 55](https://github.com/NNIIE/book-review/assets/58434352/0261d78a-8717-4187-b095-fa1ca5004828)

1. DNS에 도메인 이름으로 요청(UDP)하고 IP주소 반환
2. Client는 IP 주소로 웹서버에 요청과 응답(TCP)
3. Web Server는 필요할 시 DB와의 통신(TCP)

#### SQL / NoSQL의 중요한 차이점
* acid/트랜잭션 보장
* 스키마 유연성
* 확장성
* join

#### NoSQL을 고려해볼만한 상황
* 아주 낮은 latency를 요구함
* 비정형의 데이터 형식
* 데이터를 직렬화/역직렬화만 하면 됨
* 대용량의 데이터

<br>

## 수직확장(scale up) vs 수평확장(scale out)
* 수직확장
  * 서버스펙을 업그레이드 하는 방식
  * 확장에 한계가 있고 서버가 한대라서 장애발생에 취약하다.
* 수평확장
  * 더 많은 서버를 추가하는 방식
  * 대규모 어플리케이션 확장에 더 적합하다.

<br>

## 로드밸런서 & 데이터베이스 다중화
### 로드밸런서
여러 인스턴스에 트래픽 부하를 고르게 분산하는 역할
![image](https://github.com/NNIIE/book-review/assets/58434352/042082c4-bc2b-45af-a5d2-47aa3d316e2b)
#### 로드밸런서 종류
* **L4 로드밸런서**
  * osi 4계층에서 동작
  * ip주소와 port번호 기반
  * 어플리케이션 레벨의 세부제어가 불가능하지만, L7보다 성능이 좋다.
* **L7 로드밸런서**
  * osi 7계층에서 동작
  * http header, url, cookie 기반
  * 어플리케이션 레벨의 세부제어가 가능하지만, L4보다 성능이 안좋다. 
#### 로드밸런싱 알고리즘
* **라운드로빈**
  * 각 서버에 순차적으로 트래픽을 할당하는 방식
* **가중 라운드 로빈**
  * 서버마다 가중치를 부여하여, 높은 스펙의 서버에 더많은 트래픽을 할당하는 방식
* **최소 연결**
  * 트래픽이 발생한 시점에 가장 적은 연결상태을 가진 서버에 할당하는 방식
* **최소 응답 시간**
  * 서버의 현재 연결상태, 응답시간을 모두 고려해 가장 짧은 응답시간을 보내는 서버로 할당하는 방식
### 데이터베이스 다중화
#### 구성
* **master db**
  * 모든 write 작업을 담당
  * 변경점을 binary log에 기록
* **slave db**
  * read 작업을 담당
  * master db의 binary log를 주기적 또는 실시간으로 읽어 master db와 동일한 상태를 유지
#### 복제
* 비동기
  * slave db의 변경사항 복제 유무에 상관없이 write작업 완료시 즉시 Client에 응답
* 동기
  * slave db의 변경사항 복제를 확인한 후 Client에 응답
 
<br>

## Cache & CDN
![image](https://github.com/NNIIE/book-review/assets/58434352/8502d347-36a7-4bd3-956c-e5af1cfb3736)
### Cache
* 갱신은 자주일어나지 않지만 참조는 빈번할 경우 고려해 보자.
* 휘발성이어도 괜찮은 데이터들을 고려하자.
* expire 전략을 잘 가져가야 한다.
* DB & Cache가 단일 트랜잭션으로 묶이지 않을 경우 Atomicity가 지켜지지 않는다.
* Cache Server 장애 전파를 주의하자.
  * Cache Server가 다운될 경우 복구되는 시점이 가장 취약점이 아닐까??
    * 순간적으로 DB Read Connection 몰림
    * 어플리케이션 트래픽은 동일
    * DB Connection Pool 유휴자원 없음
    * Tomcat Thread Pool 모두 소진 -> Tomcat 대기큐 꽉참
    * 신규요청 거부 (503)
* Cache memory를 과할당 하는것도 하나의 전략이다.
* 데이터 방출 정책
  * LRU: 마지막으로 사용된지 가장 오래된 데이터 방출
  * LFU: 사용된 빈도가 가장 낮은 데이터 방출
  * FIFO: 가장 먼저 들어온 데이터를 가장 먼저 방출
### CDN
* 정적 콘텐츠를 제공하는 지리적으로 분산된 서버 네트워크
* 데이터 전송량에 따라 요금이 책정된다.
* expire 전략을 잘 가져가야 한다.
* CDN 장애에 대한 적절한 전략을 수립해야 한다.
* CDN에서 제공하는 API로 아직 만료되지 않은 콘텐츠를 무효화 할 수 있다.

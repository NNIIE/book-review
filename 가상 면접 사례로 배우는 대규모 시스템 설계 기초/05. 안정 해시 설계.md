## 해시 키 재배치 문제
* serverIndex = hash(key) % N
* 서버 풀의 크기가 고정되어 있고 데이터 분포가 균등할 때, 잘 동작한다.
* 서버가 추가되거나 삭제되면 문제가 발생 - 대규모 캐시미스

<br>

## 안정 해시
해시 테이블 크기가 조정될 때 평균적으로 k/n개의 키만 재배치 하는 해시 기술
* k: 키의 개수
* n: 슬롯의 개수

<br>

#### 해시 공간과 해시 링
일렬로 늘어뜨린 해시 함수 f의 출력값 범위를 양쪽을 구부려 접으면 해시 링이 만들어진다.

#### 해시 서버
해시함수를 이용해 해시 링 위에 서버를 배치한다.

#### 해시 키
나머지 연산을 사용하지 않는 해시 함수로 캐시할 키 또한 해시 링 위에 어느지점에 배치한다.

#### 서버 조회
어떤 키가 저장되는 서버는, 해당 키의 위치부터 시계방향으로 링을 탐색해 만나는 첫번째 서버이다.

### 서버 추가
* 이러한 방식을 사용할 경우 서버를 추가해도 모든 키가 재배치 될 필요는 없다.
* 키가운데 일부만 재배치 하면 된다.

### 서버 제거
서버가 제거 되어도 모든 키가 재배치 될 필요는 없다.

### 문제점
* 안정해시 알고리즘
  * 서버와 키를 균등 분포 해시함수를 사용해 해시링에 배치한다.
  * 키의 위치에서 시계방향으로 탐색하다 만나는 첫번째 서버가 키가 저장될 서버이다.

<br>

* 서버의 추가/삭제를 감안하면 파티션의 크기를 균등하게 유지하는 게 불가능 함.
* 탐색의 첫번째 서버에 키를 저장하는 방식은 키의 균등 분포를 달성하기가 어려움.

<br>

### 가상 노드
* 각 서버는 하나가 아닌 여러 개의 파티션을 관리하며 가상노드를 가진다.
* 키의 위치부터 시계방향으로 탐색하다 만나는 최초의 가상노드가 해당 키가 저장될 서버이다.
* 가상노드를 늘릴수록 키의 분포가 균등해 진다.
* 서버 추가/제거 시 앞뒤 서버의 키를 재배치 한다.

<br>

### 안정해시가 필요한 이유
* 서버 추가/삭제 시 재배치 되는 키의 개수 최소화
* 데이터가 균등하게 분포되서 수평 확장에 용이
* 핫스팟 키 문제 감소
  * 데이터가 전부 같은 샤드에 몰리는 상황





## 개략적 설계안
### 데이터 수집 서비스
* 사용자가 입력한 질의를 실시간으로 수집하는 시스템
* 질의와 빈도수를 카운팅하는 빈도 테이블로 가정

### 질의 서비스
* like - order by - limit 5

<br>

## 상세 설계
### 트라이 자료구조
* 문자열을 간략하게 저장할 수 있는 트리형태의 자료구조
* 루트노드(빈 문자열) - 글자하나를 저장하는 노드로 이루어짐 - 26개의 자식노드
* 접두어의 최대길이를 제한하고 각 노드에 인기 검색어를 캐시해 두는 방식으로 최적화

### 데이터 수집 서비스
* 데이터 분석 서비스 로그
  * 입력된 질의에 관한 원본 데이터 보관
  * 추가만 되고 수정은 되지 않으며 로그데이터에 인덱스를 걸지 않는다.
* 로그 취합 서버
  * 본 설계안은 일주일 주기의 취합
* 작업 서버
  * 주기적으로 비동기 작업을 하는 서버 집합
  * 트라이 자료구조를 만들고 디비에 저장하는 역할
* 트라이 캐시
  * 트라이 데이터를 메모리에 유지하는 분산 캐시 시스템
  * 매주 트라이 디비의 스냅샷을 떠서 갱신
* 트라이 데이터베이스
  * 지속성 저장소로 문서 형식, 키-값 저장소 형식을 사용할 수 있다.

### 질의 서비스
1. 검색질의가 로드밸런서를 통해 API서버로 전송
2. API서버는 트라이캐시에서 데이터를 가져와 자동완성 검색어 제안응답을 구성
3. 캐시에 없다면 디비를 다녀와 캐시를 채운다.
* AJAX, 브라우저 캐싱, 데이터샘플링을 통해 개선

### 트라이 연산
* 트라이 생성
  * 작업서버가 담당하며, 데이터 분석 서비스의 로그나 디비에 취합된 데이터를 이용
* 트라이 갱신
  * 매주 한번 갱신 (새로운 트라이를 만들고 기존 트라이를 대체)
  * 트라이의 각 노드를 개별적으로 갱신
* 검색어 삭제
  * 캐시앞에 필터 계층을 둬서 비적절한 검색어 반환 X
 
### 저장소 규모 확장
* 첫 글자를 기준으로 샤딩 (이 방법은 알파벳 기준 최대서버는 26대)
  * 두번째 레벨의 샤딩으로 두번째 글자를 사용.
 
<br>

## 추가
* 유니코드 사용으로 다국어 지원
* 국가별로 다른 트라이를 사용
* 실시간 검색어 자동 완성
  * 샤딩을 통해 작업 데이터양 줄이기
  * 순위모델을 바꿔 최근검색어에 가중치








# 정리
## 안전한 동시성 코드
* 동시성은 복잡하므로 다른코드와 분리해라.
* 자료를 캡슐화 하고, 공유 자료를 최대한 줄여라.
* 스레드는 가능한 독립적으로 구현해라.
* thread-safe 한 라이브러리를 활용해라.
* 공유객체 하나에는 메서드 하나만 사용해라.
* 동기화 부분은 최대한 작게 만들어라.
* 시스템 실패를 일회성이라고 치부하지 마라.
* 다중스레드 환경 밖에서 생기는 버그를 먼저 디버깅 해라.

<br>

# 느낀점
이번장은 매우 흥미롭게 읽었다.
<br>
성능을 개선하기 위해 공유데이터를 가져오는 부분과 구분해서 데이터 처리부분만 병렬처리로 구현한 적이 있었는데
<br>
성능측정을 위해 벤치마크 라이브러리를 사용해서 측정을 해본결과 실제로 성능이 개선되지 않고 오히려 떨어졌다.
<br>
나름 많은 고민 후 다음과 같은 결론을 내렸었는데,
* 작업큐의 분할, 스케줄링, 병합 등의 컨텍스트 스위칭 비용이 작업 연산 대비 오버헤드로 동작한다.

실제로 벤치마크 성능측정 결과가 이렇게 나와버리니 다음과 같은 조언을 따랐었다.
<br>
`이펙티브 자바 Item.48 - 계산도 올바로 수행하고 성능도 빨라질 거라는 확신 없이는 스트림 파이프라인 병렬화는 시도조차 하지말라.`
<br>
<br>
실제로 개발당시 테스트케이스는 어떻게 짜야하는지, 결과는 신뢰할만 한지 등 여러모로 골치가 아팠었다.
<br>
적어도 나에겐 다중스레드의 동시성 문제는 어려운데, 다음책으로는 병렬처리에 관한 책을 읽어봐야 겠다.
